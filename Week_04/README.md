学习笔记

# 重学js

## js语言通识

### 泛用语言分类方法

语言按语法分类：

- 非形式语言： 中文，英文等
- 形式语言：计算机语言

形式语言的分类方法有很多种，乔姆斯基谱系是其中一种。

乔姆斯基谱系：

- 0型：无限制文法
- 1型： 上下文相关文法： 同样词、句的组合可以跟上文，下文内容有关
- 2型： 上下文无关文法：同一个表达，不管放到哪，都是一个意思
- 3型： 正则/正规文法

0123型是包含关系，1型文法一定也属于0型，但是0型不一定属于1型



### 什么是产生式？

产生式有很多种描述方法，此处选择最经典最常用的<font color="blue">巴科斯-诺尔范式（简称BNF）</font>来描述。

**BNF的规则：**

- 用<>括起来的名称表示语法结构名
- 语法结构分为：
  - 基础结构：称为终结符Terminal Symbol,终结符不代表代码终止，而是类似叶子节点的概念
  - 复合结构（需要用其他语法结构定义），称为非终结符Nonterminal Symbol
- 引号和中间的字符表示终结符
- 可以有括号
- \* 表示重复多次
- | 表示或
- \+ 表示至少一次



**使用BNF描述四则运算**

```
<MultiplicativeExpression> ::= <Number> |
	<MultiplicativeExpression> "*" <Number> |
	<MultiplicativeExpression> "/" <Number> |
<AddtiveExpression> ::= <MultiplicativeExpression> |
	<AddtiveExpression> "+" <MultiplicativeExpression> |
	<AddtiveExpression> "-" <MultiplicativeExpression> |
```

四则运算: 1 + 2 * 3

终结符：

- Number
- \+ \- \* /

非终结符：

- MultiplicativeExpression
- AddtiveExpression

作业： 编写带括号的四则运算表达式



**通过产生式理解乔姆斯基谱系**

乔姆斯基谱系：

- 0型：无限制文法

  ```
  ?:: = ?
  ```

- 1型： 上下文相关文法： 同样词、句的组合可以跟上文，下文内容有关

  ```
  ?<A>?::=?<B>?
  ```

- 2型： 上下文无关文法：同一个表达，不管放到哪，都是一个意思

  ```
  <A>::=?
  ```

- 3型： 正则/正规文法

  ```
  <A>::= <A>? // 递归定义的正则，A只能出现在开头，不能出现在结尾
  <A>::= ?<A>
  ```

  

思考：javascript是上下文相关文法，上下文无关文法还是正则文法？

<font color="orange">js总体上属于上下文无关文法，其中的表达式部分大部分属于正则文法，但是有两个特例（\*\*运算符和 get）</font>

\*\*运算符是右结合的运算符， 不属于正则文法

```js
2 ** 1 ** 2 //结果为2 先计算1 ** 2
```

```
{
	get a{return 1}, // get是关键字
	get: 1 // get是属性
}
```

如果是严格按照乔姆斯基谱系来理解，js属于<font color="orange">上下文相关文法</font>。



其他产生式：EBNF, ABNF Customized



### 现代语言的分类

**现代语言的特例**

- C++中， \*可能表示乘号或指针，具体是哪个，取决于型号前面的标识符是否被声明为类型；
- VB中，<可能是小于号，也可能是xml直接量的开始，取决于当前位置是否可以接受xml直接量；
- Python中，行首的tab符和空格会根据上一行的行首空白以一定规则被处理成虚拟终结符indent或者dedent； ——这会导致Python变成完全的非形式语言，因为任何的形式化定义都没有办法定义上一行行首的概念，虽然在Python中可以被代码去处理，处理完后的Python是一个严格的形式化语言，且是上下文无关文法
- JavaScript中，/可能是除号，也可能是正则表达式开头，处理方式类似于VB，字符串模板中也需要特殊处理 } ,还有自动插入分号规则



**语言分类**

- 按照形式语言的<u>用途</u>可分为

  数据描述语言：JSON, HTML, XAML, SQL, CSS

  编程语言：C, C++, JAVA, C#, Python, Ruby, Perl, Lisp, T-SQL, Clojure, Haskell, JavaScript

  

- 按照形式语言的<u>表达方式</u>可分为

  声明式语言: 只会说明结果， JSON, HTML, XAML, SQL, CSS，Lisp, Clojure, Haskell, 

  命令式语言：会说明达成结果的每个步骤是怎么样的，C, C++, JAVA, C#, Python, Ruby, Perl,  JavaScript

练习：尽可能寻找你知道的计算机语言，尝试把他们分类



### 编程语言的性质

#### 图灵完备性

什么是图灵完备性？ 所有可计算的问题都可用来描述的这种语言，就具备图灵完备性

- 命令式——图灵机， 通过goto或者if、while来实现图灵完备性
- 声明式——lambda， 通过递归来实现图灵完备性



#### 动态与静态

|          | 动态                      | 静态             |
| -------- | ------------------------- | ---------------- |
| 运行设备 | 在用户的设备/在线服务器上 | 在程序员的设备上 |
| 运行时机 | 产品实际运行时            | 产品开发时       |
|          | Runtime                   | Compiletime      |



#### 类型系统

- **动态类型系统&&静态类型系统**

  1. 动态类型系统是在用户的机器上，用户的内存里面能够找到的类型，JavaScript是解释性语言，没有编译的过程，是典型的动态类型系统，我们在写代码时，能将类型当成字符串取出来。

  2. 静态类型系统是只在程序员编写代码时能够保留的类型信息，C++是典型的静态类型系统，最终编译到目标机器代码的时候，所有类型信息都已经被丢掉了。

  3. 在区分动态和静态时，最简单的办法就是区分它在谁的电脑上能够保留下来。
  4. java语言提供了反射机制，更像是一种半动态半静态的类型系统，在编译时主要的类型检查和类型操作都被处理掉了，但是在运行时还是可以通过反射去获取这些类型信息

- **强类型和弱类型**

  强类型不会默认发生类型转换，javascript是典型的弱类型语言

  String + Number

  String == Boolean

  有类型衍生出来的3个概念：

  1） 复合类型：

  ```
  // 1. 结构体
  {
    a: T1,
    b: T2
  }
  
  // 函数签名（函数类型，包括参数类型和返回值类型）
  (T1, T2) => T3
  
  ```

  2） 子类型：典型的语言是C++，会有子类型的概念。能用父类型的地方都能用子类型，类和类型是两个不同的概念，所有基于类的面向对象的语言都会把类的结构关系变成类型的关系。

  3） 泛型：把类型当做参数去传递给某一段代码结构，这段代码结构可能是类或者函数，分别对应着泛型类和泛型函数。泛型与子类型结合，会产生逆变/协变。

  协变：凡是能用`Array<Parent>`的地方都能用`Array<Child>`

  逆变：凡是能用`Function<Child>`的地方都能用`Function<Parent>`

  

### 一般命令式编程语言的设计方式

结构：

| 层级 | 名称       | 包含内容                                                | 说明                                                         |
| ---- | ---------- | ------------------------------------------------------- | ------------------------------------------------------------ |
| 1    | Atom       | - Identifier<br />- Literal                             | 原子级，是一个语言的最小组成单位，包括关键字，直接量，变量名等基本单位。 |
| 2    | Expression | - Atom<br />-Operator<br />-Punctuator                  | 原子级的结构通过运算符相连接，加上一些辅助符号，构成表达式的结构。js中有四则运算，按位与，逻辑运算等。 |
| 3    | Statement  | - Expression<br />- KeyWord<br />-Punctuator            | 语句是表达式加上特定的标识符、关键字和符号，形成的一定结构。如if条件语句，while和for循环语句 |
| 4    | Struction  | - Function<br />- Class<br />- Process<br />- Namespace | 结构化层级，帮助组织代码，将代码分成不同块，分成不同的复用结构， |
| 5    | Program    | - Program<br />- Module<br />- Package<br />- Library   | 用于组织代码，帮助我们更好地去管理语言的模块和安装。有的语言有，有的语言不在语言里面，而是在辅助性的设施中。在JavaScript中，扮演这个角色的是npm。JavaScript本身也有两个最顶级的定义：module（准备好被复用的模块）， program（实际执行的代码）。 |



## 重学javascript

![1603119070625](F:\frontLearning\code\geektime-front-course\Frontend-04-Template\Week_04\重学javascript.png)

对每个层级的讲解，都是以语法为线索，终点讲解语义和运行时。

运行时：实际在用户电脑上运行起来是什么样子。

通过一定的语法，表达一定的语义，最后改变运行时的状态。



js中的Atom:

| Grammar         | Runtime           |
| --------------- | ----------------- |
| Literal         | Types             |
| Variable        | Execution Context |
| Keywords        |                   |
| Whitespace      |                   |
| Line Terminator |                   |



## JS类型

Types: 

- Number
- String
- Boolean
- Object
- Null
- Undefined
- Symbol



### Number

- **IEEE754 Double Float**

  http://c.biancheng.net/view/314.html

Float代表浮点数，意思是小数点可以来回浮动，把一个数字拆成指数和有效位数，有效位数决定浮点数的表示精度，指数决定浮点数的表示范围，浮点数还有一个表示符号的位数

IEEE754 Double Float： 1个符号位 + 11个指数位 + 52个精度位，这里的位指的是bit，值为0或1

精度位乘以指数位，乘以2的指数次方

指数位因为要表示正的范围和负的范围，所以有个基准值（10000000000），比基准值大表示正，比基准值小表示负，指数位的计算要减去这个基准值。所以指数位可以表示的最大值为（11 111 111 111 - 10 000 000 000 = 1 111 111 111 = 2<sup>2048</sup> - 1）

- **Number-grammar**

| 进制     | 写法                       |
| -------- | -------------------------- |
| 十进制   | 0<br />0.<br />.2<br />1e3 |
| 二进制   | 0b11                       |
| 八进制   | 0o10                       |
| 十六进制 | 0xFF                       |

```js
0.toString(); // 报错
0 .toString(); // "0"
```



### String

- Character
- Code Point
- Encoding

```
a    97      01100001
```

**字符集：**

- ASCII： 只有一个字节，只规定了127个字符，包括26个大写字母，26个小写字母，数字0-9，各种制表符，特殊符号，换行等控制字符，没有中文字符
- Unicode：兼容ASCII， 包含全世界的各种字符，基于两个字节（0000-FFFF）的编码
- UCS: 只包含0000-FFFF的字符
- GB：同样的中文，用GB编码比用Unicode编码省空间
  - GB2312 ：兼容ASCII， 但是同一个字符，字符码点跟Unicode的码点不一致；
  - GBK(GB13000)： GB2312的扩充
  - GB18030： 大全版本
- ISO-8895：东欧国家把自己国家的语言设计成了类似GB这种在ASCII上扩展的，兼容ASCII，但自身互不兼容，8859非统一标准，ISO没有中文版本
- BIG5：台湾大五码



**Encoding**

- UTF
  - UTF8: 默认使用1个字节，超过1个字节时会出现控制位来表示字节与字节之间的关系
  - UTF16: 默认使用2个字节，超过2个字节时会出现控制位来表示字节与字节之间的关系

作业：

```js
// 用utf8对string进行编码
function UTF8_Encoding(string){
// return new Buffer();
}
```



**Grammar**

```js
"abc"

'abc' // 特殊字符用\转义表示\n \t \b \f \r\ v \x \u

`abc`


```

随堂练习：写正则表达式匹配单引号和双引号的字符串写法



### Object

任何一个对象都是唯一的，这与它本身的状态无关，所以，即使状态完全一致的两个对象，也并不相等。

用状态来描述对象，状态的改变即是行为。

对象的三个核心要素：identifier(唯一标识)、state（状态）、behavior（行为，不是现实中的行为，而是会改变对象状态的行为）



作业：狗咬人，咬这个行为该如何使用对象抽象？

```js
// 错误写法，因为狗咬人不会改变狗的状态
class dog {
	bite(person) {}
}

// 正确写法
class human {
	hurt(damage) {
		//	
	}
}
```

我们不应该受到语言描述的干扰，在设计对象的状态和行为时，我们总是遵循<u>“行为改变状态”</u>的原则。



#### **Object--Class**

类是一种常见的描述对象的方式。

“归类”和“分类”是两个主要的流派。

“归类” -- 多继承，eg: C++

“分类” -- 单继承，基类Object, eg: JAVA, C#



#### **Object--Prototype**

原型是一种更接近人类原始认知的描述对象的方法。

我们并不试图做严谨的分类，而是采用“相似”这样的方式去描述对象。

任何对象仅仅需要描述它自己与原型的<font color="orange">区别</font>即可



#### Object in **JavaScript**

在javascript运行时，原生对象的描述方式非常简单，我们只需要关心<u>原型和属性</u>两个部分。

javascript中的对象是一组<u>属性</u>的集合，属性既可以用来描述<u>状态</u>，也可以描述<u>行为</u>，每个对象都有一个原型。

用内存地址来表示js对象的<u>唯一标识性</u>。

js属性值有两种形态：数据属性（用于描述状态，如果有存储函数，也可以用来描述行为）和访问器属性（用于描述行为）。

原型链：当我们访问属性时，如果当前对象没有，则会沿着原型找原型对象是否有此属性，而原型对象还可能有原型，因此会有“原型链”这一说法。这一算法保证了，每个对象只要描述自己和原型的区别即可。



#### Object API/Grammar

- 面向对象的基本操作：{}  . [] Object.defineProperty 
- 基于原型的api：Object.create / Object.setPrototypeOf / Object.getPrototypeOf
- 基于分类的方式去描述对象：new / class / extends
- 历史，不伦不类(不推荐使用)：new / function / prototype



#### Function Object

函数是js中的特殊对象，除了有一般对象的属性和原型，还有一个行为[[call]]。

当用类似`f()`这样的语法把对象当做函数调用时，会访问到[[call]]这个行为，如果对应的对象没有[[call]]行为，则会报错。



#### Special Object

Array [[length]], 数组对象的长度会随着增加新的数字型属性而变化

Object.prototype 没有[[setPrototypeOf]]方法



#### Host Object

跟宿主环境相关的对象，如浏览器的window对象

在js中，用[[]]定义的私有方法在js语言中是访问不到的，在运行时中存在。



作业： 找出javascript标准中所有具有特殊行为的对象。